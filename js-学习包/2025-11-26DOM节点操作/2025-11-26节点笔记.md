# DOM 节点操作：多广告关闭案例笔记
## 一、案例需求
实现多个广告盒子（`.box1`）的关闭功能：点击每个广告右上角的 `X` 按钮（`.box`），精准隐藏对应的广告盒子。

## 二、核心知识点
### 1. 节点关系获取
![节点知识集](/知识点总结图集/2025-11-25节点知识集.png)

### 2. 鼠标样式控制
`cursor: pointer;`：让元素悬浮时鼠标变成“小手”，提示可点击（核心用于关闭按钮）。

### 3. 定位上下文
父元素设置 `position: relative;`，子元素（关闭按钮）设置 `position: absolute;`，可让按钮相对于父广告盒定位，避免全局重叠。

## 三、完整代码（带注释）
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多广告关闭案例</title>
    <style>
/* 广告盒子样式 */
.box1 {
  margin: 20px auto; /* 上下间距，避免盒子重叠 */
  position: relative; /* 建立定位上下文，让子按钮相对自身定位 */
  width: 400px;
  height: 200px;
  background-color: pink;
}
/* 关闭按钮样式 */
.box {
  width: 20px;
  height: 20px;
  color: white;
  background-color: black; /* 背景色让X可见 */
  text-align: center; /* 文字水平居中 */
  line-height: 20px; /* 文字垂直居中 */
  position: absolute; /* 绝对定位到广告盒右上角 */
  right: 20px;
  top: 20px;
  cursor: pointer; /* 鼠标悬浮变小手，提示可点击 */
  border-radius: 50%; /* 圆形按钮（可选） */
}
    </style>
</head>
<body>
    <!-- 测试节点关系的示例结构 -->
    <div class="dad">
        <div class="baby"></div>
    </div>

    <!-- 广告盒子1 -->
    <div class="box1">
        <div class="box">X</div>
        <h3>我是广告</h3>
    </div>
    <!-- 广告盒子2 -->
    <div class="box1">
        <div class="box">X</div>
        <h3>我是广告</h3>
    </div>
    <!-- 广告盒子3 -->
    <div class="box1">
        <div class="box">X</div>
        <h3>我是广告</h3>
    </div>

    <script>
        // 1. 基础节点关系演示：子节点获取父节点
        const baby = document.querySelector('.baby')
        console.log(baby.parentNode); // 输出 <div class="dad"></div>

        // 2. 多广告关闭核心逻辑
        // 获取所有关闭按钮（伪数组）
        const boxs = document.querySelectorAll('.box')
        // 遍历所有按钮，绑定点击事件
        for(let i = 0; i < boxs.length; i++){
            boxs[i].addEventListener('click', function(){
                // 方式1：通过parentNode获取当前按钮的父广告盒，隐藏
                this.parentNode.style.display = 'none';
                
                // 方式2：更鲁棒的写法（推荐），避免DOM结构变动失效
                // this.closest('.box1').style.display = 'none';
            })
        }

        // 补充：其他节点操作语法
        // 父找子：获取dad下的所有子元素
        // const dadChildren = document.querySelector('.dad').children;
        // 找兄弟：获取baby的下一个兄弟节点（本例无）
        // const babySibling = baby.nextElementSibling;
    </script>
</body>
</html>
```

## 四、常见问题 & 解决方案
### 问题1：关闭按钮点击后“不对应”
- 原因：广告盒子无上下间距（`margin`），或按钮定位重叠，视觉上点错按钮；
- 解决：给 `.box1` 加 `margin: 20px auto;`，确保盒子和按钮不重叠。

### 问题2：`parentNode` 失效
- 原因：DOM 结构调整（比如按钮外层加了新标签），`this.parentNode` 不再是 `.box1`；
- 解决：改用 `this.closest('.box1')`，向上查找最近的 `.box1` 元素，不受层级影响。

### 问题3：关闭按钮看不见
- 原因：无背景色，`X` 文字和广告盒背景融合；
- 解决：给 `.box` 加 `background-color: black;`，搭配 `text-align + line-height` 让文字居中。

## 五、拓展应用
1. **批量操作子节点**：通过 `parentNode.children` 遍历父元素下的所有子元素，实现批量样式修改；
2. **兄弟节点联动**：点击A按钮，修改其兄弟节点B的样式（比如显示/隐藏）；
3. **复用关闭逻辑**：封装成函数，支持不同类名的关闭盒子场景：
```javascript
function bindCloseBtn(btnSelector, boxSelector) {
  const btns = document.querySelectorAll(btnSelector);
  btns.forEach(btn => {
    btn.addEventListener('click', () => {
      btn.closest(boxSelector).style.display = 'none';
    });
  });
}
// 调用：绑定.box按钮关闭.box1盒子
bindCloseBtn('.box', '.box1');
```

## 六、核心总结
1. 节点操作的核心是“精准定位”，`parentNode`/`closest` 是最常用的父节点查找方式；
2. 绝对定位需配合父元素的 `relative`，避免元素重叠；
3. 批量绑定事件时，`this` 指向当前触发事件的元素，是实现“精准操作”的关键。